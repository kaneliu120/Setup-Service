# 落地页管理系统 — 技术文档

> **项目名称：** MySkillStore 落地页模块
> **参考原型：** openclaw-manila.netlify.app
> **创建日期：** 2026-02-11
> **技术栈：** Next.js 16 + NestJS + TypeORM + PostgreSQL + Tailwind CSS

---

## 1. 需求概述

### 1.1 背景
基于 openclaw-manila.netlify.app 落地页原型，构建一个可批量管理的多变体落地页系统。

### 1.2 核心需求
1. **前端页面**：保持与 openclaw-manila 相同的深色主题视觉风格，但支持生成**多个不同文案内容**的落地页
2. **管理后台**：提供简单的管理界面，管理员可以对多个文案落地页进行管理（创建、编辑、删除），并控制每个页面是否**显示生效**（Active/Inactive）

### 1.3 设计决策
- 使用 **JSONB** 列存储落地页内容，无需为每个字段建列，灵活可扩展
- 复用现有项目的模块化架构（与 blog 模块同构）
- 前端复用一个通用模板组件 `LandingPageTemplate`，数据驱动渲染
- 管理后台沿用现有 Admin UI 风格（shadcn/ui + purple 主题）

---

## 2. 系统架构

```
┌────────────────────────────────────────┐
│  Frontend (Next.js 16 + Tailwind)      │
│                                        │
│  /landing/[slug]    → 公开落地页        │
│  /admin/landing-pages → 管理列表       │
│  /admin/landing-pages/editor → 编辑器  │
│                                        │
│  LandingPageTemplate.tsx → 通用模板    │
└──────────────┬─────────────────────────┘
               │ API Proxy (/api/* → :3001)
┌──────────────▼─────────────────────────┐
│  Backend (NestJS + TypeORM)            │
│                                        │
│  GET    /landing-pages/public/:slug    │ ← 公开
│  GET    /landing-pages                 │ ← Admin
│  GET    /landing-pages/:id             │ ← Admin
│  POST   /landing-pages                 │ ← Admin
│  PUT    /landing-pages/:id             │ ← Admin
│  PATCH  /landing-pages/:id/toggle      │ ← Admin
│  DELETE /landing-pages/:id             │ ← Admin
└──────────────┬─────────────────────────┘
               │
┌──────────────▼─────────────────────────┐
│  PostgreSQL                            │
│  Table: landing_pages                  │
│  - id, slug, title, is_active          │
│  - content (JSONB), timestamps         │
└────────────────────────────────────────┘
```

---

## 3. 数据模型

### 3.1 数据库表结构 `landing_pages`

| 字段 | 类型 | 说明 |
|------|------|------|
| `id` | serial (PK) | 自增主键 |
| `slug` | varchar (unique) | URL 路径标识，如 `manila`, `tokyo` |
| `title` | varchar | 管理后台显示名称 |
| `is_active` | boolean (default: false) | 是否公开可访问 |
| `content` | jsonb | 落地页全部内容（见 3.2） |
| `created_at` | timestamp | 创建时间（自动） |
| `updated_at` | timestamp | 更新时间（自动） |

### 3.2 JSONB Content 结构 (`LandingPageContent`)

```typescript
interface LandingPageContent {
  // Header 区域
  header_title: string;        // 标题，如 "OpenClaw Private AI Service - Manila"
  header_subtitle?: string;    // 副标题，如 "AI私人助理安装服务"
  languages?: string[];        // 语言切换按钮，如 ["EN", "中文", "Tagalog"]
  location_label?: string;     // 位置标签，如 "Available in Manila"

  // Hero 区域
  hero_headline: string;       // 主标题，如 "Turn your PC into a real-life JARVIS."
  hero_description: string;    // 描述文案
  hero_cta_text: string;       // CTA 按钮文字，如 "Book Setup Now"

  // About 区域
  about_title: string;         // "Who am I?" 等
  about_text: string;          // 介绍文本（支持换行）

  // Services 区域
  services_title: string;      // "What I Offer" 等
  services: Array<{
    icon: string;              // emoji 或图标名（如 "✅", "rocket"）
    title: string;             // 服务标题
    description: string;       // 服务描述
  }>;

  // Pricing 区域
  pricing_title: string;       // "Flat Fee" 等
  pricing_amount: string;      // "5,000 PHP" 等
  pricing_details: string[];   // 价格明细列表

  // CTA / Contact 区域
  cta_title: string;           // "Get Automated Today" 等
  cta_description: string;     // 引导文案
  contact_methods: Array<{
    type: string;              // "whatsapp" | "telegram" | "email" | "phone"
    label: string;             // 显示标签
    value: string;             // 联系值（号码/邮箱/用户名）
  }>;

  // Footer
  footer_text: string;         // 底部文字

  // 主题定制
  primary_color?: string;      // 主色，默认 "#6366f1" (indigo)
  accent_color?: string;       // 强调色，默认 "#8b5cf6" (violet)
}
```

---

## 4. API 接口文档

### 4.1 公开接口

#### `GET /api/landing-pages/public/:slug`
根据 slug 获取已激活的落地页数据。

- **无需认证**
- **响应**：完整的 `LandingPage` 对象（仅 `is_active: true` 的页面）
- **错误**：`404 Not Found`（页面不存在或未激活）

### 4.2 管理接口（需要 JWT + Admin 权限）

所有管理接口均需要 `Authorization: Bearer <token>` 且用户角色为 `admin`。

#### `GET /api/landing-pages`
获取所有落地页列表（含未激活），按创建时间降序。

#### `GET /api/landing-pages/:id`
获取单个落地页详情。

#### `POST /api/landing-pages`
创建新落地页。

**请求体：**
```json
{
  "slug": "manila",
  "title": "Manila Landing Page",
  "is_active": false,
  "content": { /* LandingPageContent 对象 */ }
}
```

#### `PUT /api/landing-pages/:id`
更新落地页。请求体同创建，所有字段可选。

#### `PATCH /api/landing-pages/:id/toggle`
切换落地页的激活状态（Active ↔ Inactive）。

#### `DELETE /api/landing-pages/:id`
删除落地页。

---

## 5. 文件清单

### 5.1 后端文件（NestJS）

| # | 文件路径 | 类型 | 说明 |
|---|---------|------|------|
| 1 | `apps/api/src/landing-pages/entities/landing-page.entity.ts` | 新增 | TypeORM 实体 + Content 接口定义 |
| 2 | `apps/api/src/landing-pages/dto/create-landing-page.dto.ts` | 新增 | 创建 DTO |
| 3 | `apps/api/src/landing-pages/dto/update-landing-page.dto.ts` | 新增 | 更新 DTO |
| 4 | `apps/api/src/landing-pages/landing-pages.service.ts` | 新增 | 业务逻辑层 |
| 5 | `apps/api/src/landing-pages/landing-pages.controller.ts` | 新增 | API 控制器（含权限守卫） |
| 6 | `apps/api/src/landing-pages/landing-pages.module.ts` | 新增 | NestJS 模块注册 |
| 7 | `apps/api/src/app.module.ts` | 修改 | 导入 `LandingPagesModule` |

### 5.2 前端文件（Next.js）

| # | 文件路径 | 类型 | 说明 |
|---|---------|------|------|
| 8 | `apps/web/src/components/landing/LandingPageTemplate.tsx` | 新增 | 通用落地页模板组件（深色主题） |
| 9 | `apps/web/src/app/[locale]/landing/[slug]/page.tsx` | 新增 | 公开访问的动态路由页面 |
| 10 | `apps/web/src/app/[locale]/admin/landing-pages/page.tsx` | 新增 | 管理列表页 |
| 11 | `apps/web/src/app/[locale]/admin/landing-pages/editor/page.tsx` | 新增 | 创建/编辑器页面 |
| 12 | `apps/web/src/app/[locale]/admin/page.tsx` | 修改 | 管理首页增加落地页入口卡片 |

---

## 6. 页面功能说明

### 6.1 公开落地页 `/landing/[slug]`

- 深色主题（bg-gray-950）
- 页面区块顺序：Header → Hero → About → Services → Pricing → CTA/Contact → Footer
- Header：品牌名 + 语言切换 + 位置标签（绿色脉冲点）
- Hero：渐变光晕背景 + 大标题 + CTA 按钮（渐变色）
- Services：3 列卡片网格，hover 上浮动画
- Pricing：居中大字价格 + 勾选列表
- Contact：自动根据类型生成 href（mailto / wa.me / t.me / tel）
- 支持自定义 `primary_color` 和 `accent_color` 覆盖默认配色
- 404 状态：页面不存在或未激活时显示 404 提示

### 6.2 管理列表页 `/admin/landing-pages`

- 权限验证：JWT token + admin 角色
- 列表显示：标题 / slug / Active 状态 / 更新时间
- 操作按钮：
  - **显示/隐藏切换**（Eye/EyeOff 图标）— 调用 PATCH toggle
  - **预览**（新窗口打开公开页面）
  - **编辑**（跳转编辑器）
  - **删除**（confirm 确认后删除）
- 空状态：提示创建第一个落地页

### 6.3 编辑器页面 `/admin/landing-pages/editor`

- 创建模式：直接访问，使用默认模板
- 编辑模式：`?id=123` 参数加载现有数据
- 表单区块（Card 分组）：
  1. **Basic Info** — 标题、Slug（自动过滤非法字符）、Active 开关
  2. **Header** — 标题、副标题、位置标签、语言列表
  3. **Hero** — 主标题、描述、CTA 按钮文字
  4. **About** — 标题、正文
  5. **Services** — 标题 + 动态数组（添加/删除服务项）
  6. **Pricing** — 标题、金额 + 动态详情列表
  7. **CTA & Contact** — 标题、描述 + 动态联系方式（类型下拉选择）
  8. **Footer & Theme** — 底部文字 + 颜色选择器（primary / accent）

---

## 7. 使用流程

### 7.1 创建新落地页

```
1. 登录管理后台 → 进入 Landing Pages
2. 点击 "Create New"
3. 填写各区块内容
4. 设置 Slug（如 "tokyo"）
5. 选择是否立即激活
6. 保存 → 返回列表
7. 访问 /landing/tokyo 查看效果
```

### 7.2 管理落地页

```
1. 进入 Landing Pages 列表
2. 点击 Eye/EyeOff 切换可见性
3. 点击 Edit 修改内容
4. 点击 Preview 在新窗口预览
5. 点击 Delete 删除（需确认）
```

### 7.3 多变体场景示例

| Slug | 标题 | 目标 | 状态 |
|------|------|------|------|
| `manila` | Manila Landing Page | 菲律宾马尼拉市场 | Active |
| `tokyo` | Tokyo Landing Page | 日本东京市场 | Active |
| `shanghai` | Shanghai Landing Page | 中国上海市场 | Inactive |
| `manila-v2` | Manila A/B Test V2 | A/B 测试版本 | Inactive |

---

## 8. 数据库迁移

TypeORM 配置了 `synchronize: true`（开发模式），首次启动 API 服务时会自动创建 `landing_pages` 表。

**生产环境建议手动迁移：**

```sql
CREATE TABLE landing_pages (
    id SERIAL PRIMARY KEY,
    slug VARCHAR NOT NULL UNIQUE,
    title VARCHAR NOT NULL,
    is_active BOOLEAN DEFAULT false,
    content JSONB NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## 9. 技术依赖

### 后端
- `@nestjs/common`, `@nestjs/typeorm` — 框架 + ORM
- `typeorm` — 数据库操作
- `JwtAuthGuard` + `AdminGuard` — 现有认证/权限守卫

### 前端
- `next` 16.1.6 + `next-intl` — 路由 + 国际化
- `@/components/ui/*` — shadcn/ui 组件（Button, Card, Badge, Input, Textarea, Label）
- `lucide-react` — 图标库
- `@/lib/api` — Axios 实例（带 JWT 拦截器）

---

## 10. 构建验证

- 所有新增代码通过 Next.js build 验证，**零编译错误**
- 现有项目中其他页面存在 `@/components/ui/select` 缺失的预存错误，与本模块无关
- 本模块避免使用 Select 组件，改用原生 `<select>` 元素以保持兼容
